<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Piero AI ‚Äì Video Upscaler</title>

<!-- GOOGLE FONT (delgada, est√©tica, tech) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500&display=swap" rel="stylesheet">

<style>
:root {
  --bg-dark: #0b0e14;
  --bg-light: #f4f4f6;
  --text-dark: #ffffff;
  --text-light: #000000;
  --card-dark: #141824;
  --card-light: #ffffff;
  --accent: #888;
}

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  transition: background .3s, color .3s;
}

body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

/* ===== HEADER ===== */
header {
  position: relative;
  height: 220px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  cursor: pointer;
}

header h1 {
  font-weight: 300;
  font-size: 3.2rem;
  letter-spacing: 4px;
  color: white;
  transition: transform .4s ease;
  z-index: 2;
}

header:hover h1 {
  transform: scale(1.08);
}

/* estrellas */
.stars {
  position: absolute;
  width: 200%;
  height: 200%;
  background:
    radial-gradient(2px 2px at 20% 30%, white, transparent),
    radial-gradient(1px 1px at 80% 40%, white, transparent),
    radial-gradient(1.5px 1.5px at 50% 80%, white, transparent),
    radial-gradient(1px 1px at 70% 10%, white, transparent);
  animation: moveStars 20s linear infinite;
  opacity: .6;
}

header:hover .stars {
  animation-duration: 6s;
}

@keyframes moveStars {
  from { transform: translate(0,0); }
  to { transform: translate(-300px,300px); }
}

/* ===== SWITCH ===== */
.switch {
  position: absolute;
  top: 20px;
  right: 20px;
}

.switch input {
  display: none;
}

.slider {
  width: 50px;
  height: 24px;
  background: #333;
  border-radius: 20px;
  position: relative;
}

.slider::before {
  content: "üåô";
  position: absolute;
  left: 4px;
  top: 3px;
  transition: .3s;
}

input:checked + .slider {
  background: #ddd;
}

input:checked + .slider::before {
  content: "‚òÄÔ∏è";
  left: 26px;
}

/* ===== DESCRIPCI√ìN ===== */
.description {
  text-align: center;
  max-width: 700px;
  margin: 50px auto;
  font-size: 0.95rem;
  opacity: .85;
}

/* ===== CARDS ===== */
.container {
  display: flex;
  gap: 30px;
  justify-content: center;
  flex-wrap: wrap;
  padding-bottom: 80px;
}

.card {
  width: 340px;
  background: var(--card-dark);
  border-radius: 18px;
  padding: 20px;
  transition: background .3s;
}

body.light .card {
  background: var(--card-light);
}

.card h3 {
  text-align: center;
  font-weight: 400;
}

/* ===== DROP ZONE ===== */
.drop {
  border: 2px dashed var(--accent);
  border-radius: 14px;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.drop:hover {
  background: rgba(255,255,255,0.05);
}

video {
  width: 100%;
  border-radius: 12px;
  display: none;
}

/* ===== BUTTONS ===== */
button {
  margin-top: 15px;
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: #444;
  color: white;
}

button:hover { opacity: .9; }

.cancel { background: #666; }
.download { background: #222; }

/* ===== LOADER ===== */
.loader {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.loader span {
  width: 50px;
  height: 50px;
  border: 4px solid #777;
  border-top: 4px solid #ccc;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.blur {
  filter: blur(6px);
}
</style>
</head>

<body>

<header onclick="handleHeaderClick(event)">
  <div class="stars"></div>
  <h1>PIERO AI</h1>

  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <div class="slider"></div>
  </label>
</header>

<div class="description">
  Upload or drag your MP4 video into the original video box.<br>
  Click ‚ÄúScale to 4K‚Äù and let the AI enhance your video automatically.
</div>

<div class="container">

  <!-- ORIGINAL -->
  <div class="card">
    <h3>Original Video</h3>
    <div class="drop" id="dropZone">Drop or click</div>
    <video id="videoOriginal" controls></video>
    <input type="file" id="fileInput" accept="video/mp4" hidden>
    <button id="cancelBtn" class="cancel" style="display:none">Cancel</button>
  </div>

  <!-- 4K -->
  <div class="card">
    <h3>4K Video</h3>
    <video id="video4k" controls></video>
    <button id="scaleBtn">Scale to 4K</button>
    <button id="downloadBtn" class="download" style="display:none">Download</button>
  </div>

</div>

<div class="loader" id="loader">
  <span></span>
  <p id="progress">0%</p>
</div>

<script>
/* ===== HEADER CLICK ===== */
function handleHeaderClick(e){
  if(e.ctrlKey || e.metaKey){
    window.open(window.location.href,'_blank');
  }else{
    window.location.reload();
  }
}

/* ===== THEME ===== */
const toggle = document.getElementById("themeToggle");
toggle.addEventListener("change",()=>{
  document.body.classList.toggle("light", toggle.checked);
});

/* ===== VIDEO UPLOAD ===== */
const drop = document.getElementById("dropZone");
const input = document.getElementById("fileInput");
const videoOriginal = document.getElementById("videoOriginal");
const cancelBtn = document.getElementById("cancelBtn");

drop.onclick = ()=>input.click();

drop.ondragover = e => e.preventDefault();
drop.ondrop = e =>{
  e.preventDefault();
  loadVideo(e.dataTransfer.files[0]);
};

input.onchange = ()=> loadVideo(input.files[0]);

function loadVideo(file){
  if(!file) return;
  const url = URL.createObjectURL(file);
  videoOriginal.pause();
  videoOriginal.src = url;
  videoOriginal.style.display="block";
  videoOriginal.load();
  videoOriginal.play().catch(()=>{});
  cancelBtn.style.display="block";
}

/* ===== CANCEL ===== */
let controller;
cancelBtn.onclick = ()=>{
  if(controller) controller.abort();
  videoOriginal.src="";
  videoOriginal.style.display="none";
  cancelBtn.style.display="none";
};

/* ===== SCALE ===== */
const scaleBtn = document.getElementById("scaleBtn");
const video4k = document.getElementById("video4k");
const loader = document.getElementById("loader");
const progress = document.getElementById("progress");
const downloadBtn = document.getElementById("downloadBtn");

scaleBtn.onclick = async ()=>{
  if(!input.files[0]) return alert("Upload a video");

  controller = new AbortController();
  loader.style.display="flex";
  videoOriginal.classList.add("blur");
  progress.textContent="0%";

  const form = new FormData();
  form.append("file", input.files[0]);

  try{
    const res = await fetch("/upscale_sse",{method:"POST", body:form, signal:controller.signal});
    const reader = res.body.getReader();
    const decoder = new TextDecoder();

    while(true){
      const {done,value} = await reader.read();
      if(done) break;
      const text = decoder.decode(value);
      if(text.includes("progress")){
        const data = JSON.parse(text.split("data:")[1]);
        progress.textContent = Math.round(data.progress)+"%";
        if(data.video_url){
          video4k.src = data.video_url;
          video4k.style.display="block";
          downloadBtn.style.display="block";
          downloadBtn.onclick = ()=>window.open(data.video_url);
        }
      }
    }
  }catch(e){}

  loader.style.display="none";
  videoOriginal.classList.remove("blur");
};
</script>

</body>
</html>
